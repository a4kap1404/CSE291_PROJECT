# Dataset

This folder covers invocation of openroad, running synth, floorplan and placement upto step 3_2_place_iop, label generation, graph construction and formatting, and finally clustering of nodes using spectral clustering which will be used as our dataset.

We experimented with various clustering methodologies to reduce the problem size including spectral clustering, METIS and HMETIS. Due to dependency issues for the later two we decided to use spectral clustering in our experiemnts.

# Dataset Composition

The training data includes variations of designs IBEX-NanGate45, AES-NanGate45, GCD-ASAP7, IBEX-ASAP7, AES-ASAP7, and ARIANE136-NanGate45 with parameters such as Core Utilization, Core Aspect Ratio, and Place Desnity being varied. It also includes 82 synthetic designs generated using Artnet accounting for a total of 590 designs.

The test data includes JPEG-ASAP7, JPEG-NanGate45 and 100 variations of GCD-NanGate45.

We excluded SWERV_WRAPPER-NanGate45 designs as the placement run errors out with the given config.mk.

# Data Format

Formatted file (*_formatted.txt): Contains core/die bounds (Die Width, Die Height, Core Width, Core Height, lx, ly, ux, uy), global metrics (Core Aspect Ratio, Utilization, Place Density), and a list of net records. Each record is a Python dict with a driver and list of sinks, each having id, name, is_fixed, and area fields.

Label file (*_label_formatted.txt): Contains ground-truth x_center and y_center for each pin, one line per instance: &lt;ID&gt; &lt;X&gt; &lt;Y&gt;

# Datset Generation Flow

First set the design variables in &lt;repo_dir&gt;/new_workspace/set_variables.sh
The first few variables (counter_*) can be ignored as they are not used in test mode.
Enter the name of the design to be tested in DESIGN and tech_node as shown below.
Set test_mode=1 when testing (not in bulk data generation mode).

DESIGN=jpeg
tech_node=asap7
test_mode=1
threshold=50

Then follow the steps below.

## Openroad and Label Generation
We have already run the orfs_copy command to load ORFS into &lt;repo_dir&gt;/new_workspace/
Run the following command:

```bash
cd <repo_dir>/new_workspace/flow/
source get_openroad_run.sh # run placement
```

## Hypergraph generation and formatting
Run the following command to generate the formatted hypergraph file and labels to train the model:

```bash
cd <repo_dir>/new_workspace/flow/
source get_graph_label.sh # extract graph data and labels
```

## Perform clustering
Run the following command to perfrom clustering (spectral clustering) and generate the formatted hypergraph file:

```bash
cd <repo_dir>/new_workspace/flow/
source get_clusters.sh # extract graph data and labels
```

The data from &lt;repo_dir&gt;/new_workspace/raw_graph_clustered/ can now be used by the model for training and &lt;repo_dir&gt;/new_workspace/raw_graph_test/ can be used for inference. The model at &lt;repo_dir&gt;/models/base_model already points to these directories.

# Final Result Metrics

To establish a comparison between the results generated by OpenRoad and our model, we provide scripts that allow the user to run global and detailed placement on both the default OpenRoad initial placement as well as the initial placement generated by our model. This is done through the use of two scripts, namely **run_designs.sh** to run the default OpenRoad flow on the target design and **run_loop_batch.sh** to run global and detailed placement on the predicted coordinates generated by the model. The two scripts can be called through a single wrapper, **run_comparison.sh**. This script can be run in a single step as follows:

```bash 
run_comparison.sh <path to the predicted files generated by the model> 1
```

After this script is run, it stores this comparison in a file named **placement_metrics** which can be viewed by the user.

By default the path to the predicted files is **../../models/base_model/pred** as the model, during inference, stores its predictions in this specific directory. Users are free to modify this path according to convenience. All paths are relative to the flow directory inside OpenRoad and this script must be called inside flow to be functional.
